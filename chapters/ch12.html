<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chapter 12 ‚Äî Discounted Cash Flows & Valuation</title>
<style>
  :root{
    --bg:#0f1116; --panel:#141821; --sunken:#0b0e14;
    --text:#ffffff; --muted:#a5b3d9; --accent:#7aa2f7; --good:#4ade80; --bad:#f87171; --warn:#facc15;
    --card:#0f1522; --cardEdge:#1b2233; --chip:#192033;
    --success:#34d399; --danger:#f87171;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,var(--bg),#0c0f15 50%, var(--bg));
    color:var(--text); font:15px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    display:flex; gap:0;
  }
  /* Sidebar */
  .sidebar{
    width:280px; background:var(--panel); border-right:1px solid #1d2332; padding:18px 12px; position:sticky; top:0; height:100vh; overflow:auto;
  }
  .brand{display:flex; align-items:center; gap:10px; padding:6px 10px 14px; border-bottom:1px solid #1c2230; margin-bottom:14px}
  .brand .dot{width:10px; height:10px; border-radius:50%; background:conic-gradient(var(--accent), #8bd5ff)}
  .brand h1{font-size:16px; margin:0; letter-spacing:.3px; color:#ffffff}
  .tablist{display:flex; flex-direction:column; gap:8px; margin-top:10px}
  .tabbtn{
    text-align:left; width:100%; border:1px solid #20283a; background:var(--sunken);
    color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer; transition:.15s ease;
  }
  .tabbtn:hover{border-color:#2a3550; transform:translateY(-1px)}
  .tabbtn.active{background:#122038; border-color:#2b3f6b; box-shadow:0 0 0 2px #1f2a44 inset}
  .small{color:var(--muted); font-size:12px}

  /* Main */
  .main{flex:1; min-width:0; padding:24px; overflow:auto}
  .hero{
    background:radial-gradient(1200px 400px at 20% -20%, #203255 0%, transparent 60%),
               radial-gradient(800px 300px at 110% -30%, #1a263f 0%, transparent 70%);
    border:1px solid #1c2436; border-radius:14px; padding:20px; margin-bottom:18px;
  }
  h2{margin:0 0 10px 0; font-size:22px; color:#ffffff}
  h3{margin:22px 0 8px; font-size:18px; color:#ffffff}
  p{margin:8px 0; color:#ffffff}
  .chip{display:inline-block; background:var(--chip); border:1px solid #24304a; color:#ffffff; padding:4px 8px; border-radius:999px; font-size:12px; margin:2px 4px 2px 0}
  .grid{display:grid; gap:14px}
  .grid.cols-2{grid-template-columns:repeat(auto-fit, minmax(280px,1fr))}
  .panel{background:var(--panel); border:1px solid #1c2436; border-radius:14px; padding:16px}
  .callout{border-left:3px solid var(--accent); background:#0f1728; padding:10px 12px; border-radius:8px; color:#ffffff}
  .katex{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  code, .monospace{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:13px; color:#ffffff}
  .muted{color:var(--muted)}

  /* Cards */
  .cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
  .qcard{
    perspective:1000px; height:150px;
  }
  .q-inner{position:relative; height:100%; transform-style:preserve-3d; transition:transform .55s cubic-bezier(.2,.7,.2,1)}
  .qcard:hover .q-inner{transform:rotateY(180deg)}
  .face{
    position:absolute; inset:0; backface-visibility:hidden; background:var(--card); border:1px solid var(--cardEdge);
    border-radius:14px; padding:14px; display:flex; align-items:center; justify-content:center; text-align:center; color:#ffffff
  }
  .face.back{transform:rotateY(180deg); background:#0f1626}
  .face strong{color:#ffffff}

  /* MCQs */
  .mcq{background:var(--panel); border:1px solid #1c2436; border-radius:14px; padding:16px; margin:10px 0}
  .mcq h4{margin:0 0 10px 0; color:#ffffff}
  .opt{display:block; padding:8px 10px; margin:6px 0; border:1px solid #20283a; border-radius:10px; cursor:pointer; color:#ffffff}
  .opt:hover{background:#101728}
  .correct{border-color:#275b3c; background:#0f1b17}
  .wrong{border-color:#5b2727; background:#1b0f10}
  .explain{display:none; margin-top:8px; color:#ffffff}
  .spacer{height:8px}
  .solutions-block{display:none; padding:10px; border-top:1px dashed #2b3752; margin-top:8px; color:#ffffff}
  .btn{background:#13213a; border:1px solid #273758; color:#ffffff; padding:8px 10px; border-radius:10px; cursor:pointer}
  .btn:hover{background:#152747}
  .btn.ghost{background:transparent; color:#ffffff; border:1px solid #1c2436}

  /* Short Qs & Practice */
  details{background:var(--sunken); border:1px solid #23304a; border-radius:12px; padding:10px 12px; margin:10px 0}
  summary{cursor:pointer; font-weight:600; color:#ffffff}
  .solve{margin-top:8px; color:#ffffff}
  .tag{font-size:11px; padding:2px 6px; border:1px solid #2a3552; background:#101727; border-radius:999px; color:#ffffff; margin-left:6px}

  /* Tabs */
  .tabcontent{display:none}
  .tabcontent.active{display:block; animation:fade .25s ease}
  @keyframes fade{from{opacity:.5; transform:translateY(2px)} to{opacity:1; transform:none}}

  /* GAME STYLES */
  .game-arena{text-align:center;max-width:800px;margin:0 auto}
  .game-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}
  .stat-card{background:linear-gradient(145deg,#0f1830,#1a2640);border:1px solid #1c2436;border-radius:12px;padding:1rem;text-align:center}
  .stat-value{font-size:2rem;font-weight:700;color:var(--accent);margin:0}
  .stat-label{font-size:.85rem;color:var(--muted);margin:.25rem 0 0}
  .question-card{background:var(--card);border:2px solid #1c2436;border-radius:16px;padding:2rem;margin:1.5rem 0;min-height:200px;position:relative;overflow:hidden}
  .question-card.correct{border-color:var(--success);background:linear-gradient(145deg,#0a1a0f,var(--card))}
  .question-card.wrong{border-color:var(--danger);background:linear-gradient(145deg,#1a0a0a,var(--card))}
  .question-text{font-size:1.25rem;font-weight:600;margin-bottom:1.5rem;line-height:1.4;color:#ffffff}
  .answer-options{display:grid;gap:.75rem;max-width:500px;margin:0 auto}
  .answer-btn{background:linear-gradient(145deg,#1a2640,#0f1830);border:2px solid #1c2436;color:#ffffff;padding:1rem;border-radius:12px;cursor:pointer;transition:all .2s;font-size:1rem;font-weight:500}
  .answer-btn:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 4px 12px rgba(122,162,247,.3)}
  .answer-btn.correct{border-color:var(--success);background:linear-gradient(145deg,#0a1a0f,#1a4a2a)}
  .answer-btn.wrong{border-color:var(--danger);background:linear-gradient(145deg,#1a0a0a,#4a1a1a)}
  .timer-bar{height:6px;background:#1c2436;border-radius:3px;overflow:hidden;margin-bottom:1rem}
  .timer-fill{height:100%;background:linear-gradient(90deg,var(--danger),#fbbf24,var(--success));transition:width .1s linear}
  .streak-indicator{position:absolute;top:1rem;right:1rem;background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#0a1020;padding:.5rem 1rem;border-radius:999px;font-weight:700;font-size:.9rem}
  .game-over{text-align:center;padding:2rem}
  .final-score{font-size:3rem;font-weight:700;color:var(--accent);margin:1rem 0}
  .performance{margin:1.5rem 0}
  .perf-item{display:inline-block;margin:.5rem 1rem;font-size:1.1rem;color:#ffffff}
  .leaderboard{background:var(--card);border-radius:12px;padding:1.5rem;margin-top:1.5rem}
  .lb-entry{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #1c2436;color:#ffffff}
  .lb-entry:last-child{border-bottom:none}
  .difficulty-select{margin-bottom:1.5rem}
  .diff-btn{margin:0 .5rem;padding:.75rem 1.5rem;border-radius:8px;cursor:pointer;border:2px solid #1c2436;background:var(--panel);color:#ffffff}
  .diff-btn.active{border-color:var(--accent);background:linear-gradient(145deg,#8bd5ff,var(--accent));color:#0a1020}

  /* Animations */
  @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
  @keyframes shake{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-5px)}20%,40%,60%,80%{transform:translateX(5px)}}
  .bounce{animation:bounce .5s ease}
  .shake{animation:shake .5s ease}

  @media (max-width:940px){
    .sidebar{position:fixed; inset:0 auto 0 0; z-index:40; transform:translateX(-100%); transition:.2s ease}
    .sidebar.show{transform:none}
    .main{padding:16px}
    .toggleNav{position:fixed; top:12px; left:12px; z-index:50}
  }

  /* Additional styling */
  ul{color:#ffffff}
  li{color:#ffffff; margin:.25rem 0}
</style>
</head>
<body>
  <button class="btn toggleNav" type="button" onclick="toggleNav()" aria-label="Toggle navigation">‚ò∞</button>
  <aside class="sidebar" id="nav" aria-label="Lesson navigation">
    <div class="brand"><span class="dot" aria-hidden="true"></span><h1>FIN 311 ‚Ä¢ Ch.12 DCF & Valuation</h1></div>
    <div class="tablist" role="tablist">
      <button class="tabbtn active" role="tab" aria-selected="true" onclick="showTab('review')">üìò Review</button>
      <button class="tabbtn" role="tab" aria-selected="false" onclick="showTab('qcards')">üß† Q-cards</button>
      <button class="tabbtn" role="tab" aria-selected="false" onclick="showTab('mcqs')">üìù MCQs</button>
      <button class="tabbtn" role="tab" aria-selected="false" onclick="showTab('shorts')">‚úçÔ∏è Short Questions</button>
      <button class="tabbtn" role="tab" aria-selected="false" onclick="showTab('practice')">üìä Practice Problems</button>
      <button class="tabbtn" role="tab" aria-selected="false" onclick="showTab('game')">üéÆ DCF Challenge</button>
      <div class="small" style="margin-top:10px">
        Master valuation through speed! Test DCF concepts, WACC calculations, and enterprise value bridges.
      </div>
    </div>
  </aside>

  <main class="main">
    <!-- REVIEW -->
    <section id="review" class="tabcontent active" role="tabpanel">
      <div class="hero">
        <h2>Chapter 12 ‚Äî Discounted Cash Flows & Valuation</h2>
        <div class="muted">What you'll master: time-value building blocks, projecting free cash flow, discounting at the right rate (WACC/Ke), terminal value, and turning enterprise value into price per share.</div>
        <div style="margin-top:10px">
          <span class="chip">PV/FV</span><span class="chip">Annuities & Perpetuities</span><span class="chip">NPV</span><span class="chip">FCFF vs FCFE</span>
          <span class="chip">WACC</span><span class="chip">CAPM</span><span class="chip">Terminal Value</span><span class="chip">Enterprise ‚Üí Equity</span>
        </div>
      </div>

      <div class="grid cols-2">
        <div class="panel">
          <h3>1) Core concepts (read slowly, then paraphrase)</h3>
          <ul>
            <li><strong>Value = PV of expected cash flows</strong> discounted at a rate that reflects their risk and timing.</li>
            <li><strong>Compounding:</strong> <code>FV<sub>n</sub> = PV(1+r)<sup>n</sup></code>. <span class="muted">(grows forward)</span></li>
            <li><strong>Discounting:</strong> <code>PV = FV<sub>n</sub>/(1+r)<sup>n</sup></code>. <span class="muted">(brings back)</span></li>
            <li><strong>Annuity (end-of-period):</strong> <code>PVA = C ¬∑ [1 ‚àí (1+r)<sup>‚àín</sup>]/r</code>. Annuity‚Äëdue √ó <code>(1+r)</code>.</li>
            <li><strong>Perpetuity:</strong> <code>PV = C/r</code>. <strong>Growing perpetuity:</strong> <code>PV<sub>0</sub> = C<sub>1</sub>/(r‚àíg)</code> (require <code>r &gt; g</code>).</li>
            <li><strong>NPV rule:</strong> accept if NPV &gt; 0 (maximizes shareholder value).</li>
          </ul>
          <div class="callout"><strong>Mental model:</strong> <strong>Cash flows first, discount rate second, shares last.</strong> Never start by "picking a multiple."</div>
        </div>

        <div class="panel">
          <h3>2) Cash flows for valuation</h3>
          <ul>
            <li><strong>Free Cash Flow to Firm (FCFF)</strong> = EBIT(1‚ÄìT) + Depreciation ‚Äì Capex ‚Äì ŒîNWC. Discounts at <em>WACC</em>. Produces <em>Enterprise Value</em>.</li>
            <li><strong>Free Cash Flow to Equity (FCFE)</strong> = Net income + Depreciation ‚Äì Capex ‚Äì ŒîNWC + Net borrowing. Discounts at <em>cost of equity</em>. Produces <em>Equity Value</em> directly.</li>
            <li><strong>Enterprise Value ‚Üí Equity Value:</strong> Equity = EV ‚Äì Net debt ‚Äì Preferred ‚Äì NCI + Excess cash.</li>
          </ul>
          <div class="callout">For project valuation, FCFF is standard; for banks or where leverage is policy-driven, use dividend/FCFE approaches.</div>
        </div>

        <div class="panel">
          <h3>3) Discount rate</h3>
          <ul>
            <li><strong>Cost of equity (CAPM):</strong> <code>K<sub>e</sub> = r<sub>f</sub> + Œ≤ ¬∑ (E[R<sub>m</sub>] ‚àí r<sub>f</sub>)</code>.</li>
            <li><strong>After-tax cost of debt:</strong> <code>K<sub>d</sub>(1‚àíT)</code>.</li>
            <li><strong>WACC:</strong> <code>WACC = (E/(D+E))¬∑K<sub>e</sub> + (D/(D+E))¬∑K<sub>d</sub>(1‚àíT)</code>. Use market weights.</li>
          </ul>
          <div class="muted">Use nominal rates with nominal cash flows; real with real. Match currency and inflation consistently.</div>
        </div>

        <div class="panel">
          <h3>4) Terminal value (TV)</h3>
          <ul>
            <li><strong>Perpetuity growth (Gordon):</strong> <code>TV<sub>n</sub> = FCF<sub>n+1</sub> / (WACC ‚àí g)</code> at final forecast year <code>n</code>.</li>
            <li><strong>Exit multiple:</strong> apply a market multiple (e.g., EV/EBITDA) to year <code>n</code> metric; sanity‚Äëcheck with the Gordon formula.</li>
          </ul>
          <div class="callout"><strong>Common mistake:</strong> using an aggressive perpetual growth <code>g</code> is okay if it's near long‚Äërun GDP growth; never set <code>g ‚â• WACC</code>.</div>
        </div>

        <div class="panel">
          <h3>5) Putting it together: DCF workflow</h3>
          <ol>
            <li>Forecast revenue ‚Üí margins ‚Üí <strong>FCFF</strong> for 5‚Äì10 years.</li>
            <li>Choose <strong>WACC</strong>; compute PV of each FCFF.</li>
            <li>Compute <strong>Terminal Value</strong>; discount to PV.</li>
            <li>EV = Œ£ PV(FCFF) + PV(TV). Then to Equity Value and per‚Äëshare.</li>
            <li>Run <strong>sensitivity</strong> on WACC and TV growth/multiple.</li>
          </ol>
        </div>

        <div class="panel">
          <h3>6) Mini examples</h3>
          <p><strong>A) NPV of uneven cash flows</strong></p>
          <div class="katex">CF<sub>0</sub>=‚àí1,000; CF<sub>1..3</sub> = 500, 500, 500; r=10% ‚Üí PVA<sub>3,10%</sub>=500√ó2.4869=1,243.4 ‚Üí NPV=243.4 ‚úì</div>
          <p><strong>B) FCFF to EV</strong></p>
          <div class="katex">FCFF<sub>1..3</sub>=30, 40, 50; WACC=8%; TV at 3 with g=3% ‚áí TV<sub>3</sub>=50√ó1.03/(.08‚àí.03)=1,030.</div>
          <div class="katex">PV = 30/1.08 + 40/1.08¬≤ + 50/1.08¬≥ + 1,030/1.08¬≥ = 27.78+34.29+39.69+817.42 = <strong>919.18 (EV)</strong>.</div>
          <div class="katex">Equity = EV ‚àí Net debt(200) = <strong>719.18</strong>. If shares=100 ‚Üí <strong>$7.19/share</strong>.</div>
        </div>
      </div>
    </section>

    <!-- Q-CARDS -->
    <section id="qcards" class="tabcontent" role="tabpanel" aria-hidden="true">
      <div class="panel">
        <h3>Flip Q-cards ‚Äî Chapter 12 core terms</h3>
        <div class="cards">
          <!-- 20 cards -->
          <div class="qcard"><div class="q-inner">
            <div class="face"><strong>DCF (definition)</strong></div>
            <div class="face back">Value = PV of expected future cash flows discounted at a risk-appropriate rate.</div>
          </div></div>

          <div class="qcard"><div class="q-inner">
            <div class="face"><strong>FCFF vs FCFE</strong></div>
            <div class="face back">FCFF to firm discounted at WACC ‚Üí EV. FCFE to equity discounted at Ke ‚Üí Equity value.</div>
          </div></div>

          <div class="qcard"><div class="q-inner">
            <div class="face"><strong>WACC</strong></div>
            <div class="face back">Weighted average of Ke and after-tax Kd using market weights; discount rate for FCFF.</div>
          </div></div>

          <div class="qcard"><div class="q-inner">
            <div class="face"><strong>CAPM</strong></div>
            <div class="face back">Ke = rf + Œ≤(MRP). Risk free + beta √ó market risk premium.</div>
          </div></div>

          <div class="qcard"><div class="q-inner">
            <div class="face"><strong>Terminal Value (Gordon)</strong></div>
            <div class="face back">TV<sub>n</sub>= FCF<sub>n+1</sub> / (WACC ‚àí g). Discount TV back to t=0.</div>
          </div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Enterprise ‚Üí Equity</strong></div>
            <div class="face back">Equity = EV ‚àí Net Debt ‚àí Pref ‚àí NCI + Excess cash.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>NPV rule</strong></div>
            <div class="face back">Accept if NPV&gt;0. It directly measures value creation in dollars.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Annuity</strong></div>
            <div class="face back">Equal cash flows each period; PV = C[1‚àí(1+r)<sup>‚àín</sup>]/r.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Perpetuity</strong></div>
            <div class="face back">Cash flow forever; PV = C/r. Growing: C<sub>1</sub>/(r‚àíg).</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Economic vs Accounting profit</strong></div>
            <div class="face back">DCF uses cash, not accrual earnings; add back non-cash, subtract capex and ŒîNWC.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>ŒîNWC</strong></div>
            <div class="face back">Increase in operating current assets minus operating current liabilities ‚Üí cash outflow.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Cost of debt</strong></div>
            <div class="face back">Market yield to maturity; use after-tax Kd(1‚àíT).</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Sensitivity</strong></div>
            <div class="face back">Vary WACC & g (or exit multiple) to see valuation range.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Check: r vs g</strong></div>
            <div class="face back">Perpetual growth g must be &lt; discount rate; typically ‚â§ long-run GDP growth.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Equity bridges</strong></div>
            <div class="face back">EV to equity bridge reconciles EV with net financial position & other claims.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Nominal vs Real</strong></div>
            <div class="face back">Match cash flows & discount rates (both nominal or both real).</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>PV/FV</strong></div>
            <div class="face back">PV = FV/(1+r)^n ; FV = PV(1+r)^n .</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Annuity-due</strong></div>
            <div class="face back">Cash flows start today; multiply ordinary annuity value by (1+r).</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>Money left on table?</strong></div>
            <div class="face back">In IPOs (Ch.15) = (first-day close ‚àí offer)√óshares; in DCF, "table" = negative NPV choices.</div></div></div>

          <div class="qcard"><div class="q-inner"><div class="face"><strong>When to use multiples</strong></div>
            <div class="face back">For sanity-check or when forecast quality is poor; still anchor to DCF logic.</div></div></div>
        </div>
      </div>
    </section>

    <!-- MCQS -->
    <section id="mcqs" class="tabcontent" role="tabpanel" aria-hidden="true">
      <div class="panel">
        <h3>MCQs ‚Äî Discounted Cash Flows & Valuation</h3>

        <!-- Block 1: Q1-5 -->
        <div class="mcq">
          <h4>1) The value of a firm in DCF is primarily the present value of:</h4>
          <label class="opt"><input type="radio" name="q1"> Accounting earnings discounted at WACC</label>
          <label class="opt" data-correct="1"><input type="radio" name="q1"> Free cash flows discounted at a risk-appropriate rate</label>
          <label class="opt"><input type="radio" name="q1"> Book value of equity</label>
          <div class="explain">Cash, not accrual; FCFF‚ÜíWACC or FCFE‚ÜíKe.</div>
        </div>

        <div class="mcq">
          <h4>2) FCFF is discounted at:</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q2"> WACC</label>
          <label class="opt"><input type="radio" name="q2"> Cost of equity</label>
          <label class="opt"><input type="radio" name="q2"> Pre-tax cost of debt</label>
          <div class="explain">FCFF serves all capital providers ‚Üí WACC.</div>
        </div>

        <div class="mcq">
          <h4>3) Which increases WACC (all else equal)?</h4>
          <label class="opt"><input type="radio" name="q3"> Higher tax rate</label>
          <label class="opt" data-correct="1"><input type="radio" name="q3"> Higher market risk premium with same beta</label>
          <label class="opt"><input type="radio" name="q3"> More low-cost debt financing</label>
          <div class="explain">MRP ‚Üë ‚Üí Ke ‚Üë ‚Üí WACC ‚Üë. Higher T lowers after-tax Kd.</div>
        </div>

        <div class="mcq">
          <h4>4) Terminal value (perpetuity growth) equals:</h4>
          <label class="opt"><input type="radio" name="q4"> FCF<sub>n</sub> / (WACC ‚àí g)</label>
          <label class="opt" data-correct="1"><input type="radio" name="q4"> FCF<sub>n+1</sub> / (WACC ‚àí g)</label>
          <label class="opt"><input type="radio" name="q4"> EBITDA<sub>n</sub> √ó (WACC ‚àí g)</label>
          <div class="explain">Use the next period cash flow in Gordon's formula.</div>
        </div>

        <div class="mcq">
          <h4>5) With r=10%, which statement is true?</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q5"> PV of a perpetuity paying $100 is $1,000.</label>
          <label class="opt"><input type="radio" name="q5"> PV of a perpetuity paying $100 is $900.</label>
          <label class="opt"><input type="radio" name="q5"> PV cannot be computed without g.</label>
          <div class="explain">PV = 100/0.10 = 1,000.</div>
        </div>
        <button class="btn" type="button" onclick="blockSolutions(1)">Show solutions for 1‚Äì5</button>
        <div class="solutions-block" id="sol-1">
          <div>Answers: 1) Free cash flows; 2) WACC; 3) MRP ‚Üë ‚Üí WACC ‚Üë; 4) FCF<sub>n+1</sub>/(WACC‚àíg); 5) $1,000.</div>
        </div>

        <div class="spacer"></div>

        <!-- Block 2: Q6-10 -->
        <div class="mcq">
          <h4>6) Given EV from DCF, equity value is EV minus:</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q6"> Net debt and other non-equity claims</label>
          <label class="opt"><input type="radio" name="q6"> EBITDA</label>
          <label class="opt"><input type="radio" name="q6"> CAPEX</label>
          <div class="explain">Bridge EV ‚Üí Equity by subtracting net debt, etc.</div>
        </div>

        <div class="mcq">
          <h4>7) A growing perpetuity requires which condition?</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q7"> r &gt; g</label>
          <label class="opt"><input type="radio" name="q7"> r = g</label>
          <label class="opt"><input type="radio" name="q7"> g &gt; r</label>
          <div class="explain">Otherwise PV would explode.</div>
        </div>

        <div class="mcq">
          <h4>8) CAPM: rf=3%, Œ≤=1.2, MRP=5% ‚Üí Ke = ?</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q8"> 9%</label>
          <label class="opt"><input type="radio" name="q8"> 8%</label>
          <label class="opt"><input type="radio" name="q8"> 6%</label>
          <div class="explain">3% + 1.2√ó5% = 9%.</div>
        </div>

        <div class="mcq">
          <h4>9) FCFF year 1‚Äì3 = 30, 40, 50; WACC=8%; g=3% from year 3. EV is closest to:</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q9"> ~$919</label>
          <label class="opt"><input type="radio" name="q9"> ~$870</label>
          <label class="opt"><input type="radio" name="q9"> ~$960</label>
          <div class="explain">Worked in Review ‚Üí ~919.</div>
        </div>

        <div class="mcq">
          <h4>10) Increasing ŒîNWC in forecasts will generally:</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q10"> Reduce FCFF and valuation</label>
          <label class="opt"><input type="radio" name="q10"> Increase FCFF</label>
          <label class="opt"><input type="radio" name="q10"> No effect</label>
          <div class="explain">More cash tied in operations ‚Üí lower free cash flow.</div>
        </div>
        <button class="btn" type="button" onclick="blockSolutions(2)">Show solutions for 6‚Äì10</button>
        <div class="solutions-block" id="sol-2">
          <div>Answers: 6) Net debt & other claims; 7) r &gt; g; 8) 9%; 9) ~919; 10) Reduce.</div>
        </div>

        <div class="spacer"></div>

        <!-- Block 3: Q11-15 (with a couple drawn from your TVM quizzes) -->
        <div class="mcq">
          <h4>11) PV of $25,000 received in 6 years at 7%?</h4>
          <label class="opt"><input type="radio" name="q11"> $15,110</label>
          <label class="opt" data-correct="1"><input type="radio" name="q11"> ~$16,661</label>
          <label class="opt"><input type="radio" name="q11"> $17,800</label>
          <div class="explain">PV = 25,000/(1.07)^6 ‚âà 16,661.</div>
        </div>

        <div class="mcq">
          <h4>12) PV of a perpetuity paying $100k at 6%?</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q12"> $1,666,667</label>
          <label class="opt"><input type="radio" name="q12"> $1,500,000</label>
          <label class="opt"><input type="radio" name="q12"> $6,000,000</label>
          <div class="explain">PV=C/r = 100,000/0.06.</div>
        </div>

        <div class="mcq">
          <h4>13) Effective annual rate for APR 10% compounded quarterly?</h4>
          <label class="opt"><input type="radio" name="q13"> 10.00%</label>
          <label class="opt" data-correct="1"><input type="radio" name="q13"> 10.38%</label>
          <label class="opt"><input type="radio" name="q13"> 10.25%</label>
          <div class="explain">EAR=(1+0.10/4)^4 ‚àí1 ‚âà 10.38%.</div>
        </div>

        <div class="mcq">
          <h4>14) DCF gives EV = 900; net debt = 200; shares = 100. Implied price/share?</h4>
          <label class="opt" data-correct="1"><input type="radio" name="q14"> $7.00</label>
          <label class="opt"><input type="radio" name="q14"> $9.00</label>
          <label class="opt"><input type="radio" name="q14"> $5.00</label>
          <div class="explain">Equity = 900 ‚àí 200 = 700 ‚Üí 700/100 = $7.</div>
        </div>

        <div class="mcq">
          <h4>15) Which change most likely <em>raises</em> valuation?</h4>
          <label class="opt"><input type="radio" name="q15"> Increase WACC</label>
          <label class="opt" data-correct="1"><input type="radio" name="q15"> Lower WACC or higher long-run g (with r&gt;g)</label>
          <label class="opt"><input type="radio" name="q15"> Larger ŒîNWC</label>
          <div class="explain">Lower discounting and reasonable growth lift PV.</div>
        </div>
        <button class="btn" type="button" onclick="blockSolutions(3)">Show solutions for 11‚Äì15</button>
        <div class="solutions-block" id="sol-3">
          <div>Answers: 11) ~$16,661; 12) $1.667m; 13) 10.38%; 14) $7/share; 15) Lower WACC / higher g (with r&gt;g).</div>
        </div>
      </div>
    </section>

    <!-- SHORT QUESTIONS -->
    <section id="shorts" class="tabcontent" role="tabpanel" aria-hidden="true">
      <div class="panel">
        <h3>Short Questions ‚Äî applied numericals (fully worked)</h3>

        <details><summary><strong>A) Lump-sum PV</strong> ‚Ä¢ Receive $30,000 in 5 years, r = 8% <span class="tag">TVM</span></summary>
          <div class="solve">PV = 30,000/(1.08)^5 = 30,000/1.4693 = <strong>$20,419</strong>.</div>
        </details>

        <details><summary><strong>B) Ordinary annuity PV</strong> ‚Ä¢ $1,500 at year-end for 8 years, r = 6% <span class="tag">Annuity</span></summary>
          <div class="solve">PVA = 1,500√ó[1‚àí(1.06)^‚àí8]/0.06 = 1,500√ó6.2098 = <strong>$9,315</strong>.</div>
        </details>

        <details><summary><strong>C) Growing perpetuity</strong> ‚Ä¢ First cash flow $2.5m next year, WACC 9%, g 2.5% <span class="tag">Terminal Value</span></summary>
          <div class="solve">TV at year 0 (if first flow is at t=1): PV = 2.5 / (0.09‚àí0.025) = <strong>$38.46m</strong>.</div>
        </details>

        <details><summary><strong>D) Cost of equity (CAPM)</strong> ‚Ä¢ rf 3.5%, Œ≤ 1.1, MRP 5.5% <span class="tag">CAPM</span></summary>
          <div class="solve">Ke = 3.5% + 1.1√ó5.5% = <strong>9.55%</strong>.</div>
        </details>

        <details><summary><strong>E) FCFF to EV</strong> ‚Ä¢ FCFF: 12, 14, 16; WACC 8%; g after Y3 = 2% <span class="tag">DCF</span></summary>
          <div class="solve">
            TV<sub>3</sub>=16√ó1.02/(.08‚àí.02)=272. <br/>
            PV = 12/1.08 + 14/1.08¬≤ + 16/1.08¬≥ + 272/1.08¬≥ = 11.11 + 12.01 + 12.70 + 216.04 = <strong>251.86 (EV)</strong>.
          </div>
        </details>

        <details><summary><strong>F) Equity bridge</strong> ‚Ä¢ EV 252; net debt 40; cash 10; preferred 5; shares 50 <span class="tag">Bridge</span></summary>
          <div class="solve">Net debt = Debt ‚àí Cash. If "net debt 40" already netted, equity = 252 ‚àí 40 ‚àí 5 = 207 ‚Üí price = <strong>$4.14</strong>.</div>
        </details>

        <details><summary><strong>G) EAR from APR</strong> ‚Ä¢ APR 18% quarterly <span class="tag">Rates</span></summary>
          <div class="solve">EAR=(1+0.18/4)^4‚àí1=(1.045)^4‚àí1= <strong>19.25%</strong>.</div>
        </details>
      </div>
    </section>

    <!-- PRACTICE PROBLEMS -->
    <section id="practice" class="tabcontent" role="tabpanel" aria-hidden="true">
      <div class="panel">
        <h3>Practice problems ‚Äî DCF & valuation</h3>

        <details><summary><strong>1) NPV (uneven)</strong> ‚Ä¢ CF<sub>0</sub>=‚àí120; CF<sub>1..4</sub>=40,45,50,55; r=9%</summary>
          <div class="solve">
            PV inflows = 40/1.09 + 45/1.09¬≤ + 50/1.09¬≥ + 55/1.09‚Å¥ = 36.70 + 37.91 + 38.60 + 38.96 = 152.17.<br/>
            NPV = 152.17 ‚àí 120 = <strong>+32.17</strong> ‚Üí accept.
          </div>
        </details>

        <details><summary><strong>2) FCFF forecast to EV</strong> ‚Ä¢ EBIT 80; tax 25%; D&A 20; Capex 35; ŒîNWC 8; WACC 9%; assume steady state, g=2%</summary>
          <div class="solve">
            FCFF = EBIT(1‚àíT)+D&A‚àíCapex‚àíŒîNWC = 80√ó0.75+20‚àí35‚àí8 = <strong>37</strong>.<br/>
            TV (today, if flow is next year) = 37/(0.09‚àí0.02) = <strong>528.6 (EV)</strong>.
          </div>
        </details>

        <details><summary><strong>3) FCFE valuation</strong> ‚Ä¢ Net income 55; D&A 15; Capex 25; ŒîNWC 6; Net borrowing +5; Ke 10%; g 3%</summary>
          <div class="solve">
            FCFE = 55+15‚àí25‚àí6+5 = <strong>44</strong>. Equity value (perpetuity with growth) = 44/(0.10‚àí0.03) = <strong>628.6</strong>.
          </div>
        </details>

        <details><summary><strong>4) WACC</strong> ‚Ä¢ Ke 10.5%; pre-tax Kd 6%; tax 25%; E=300, D=200 (market)</summary>
          <div class="solve">
            WACC = (300/500)√ó10.5% + (200/500)√ó6%√ó(1‚àí0.25) = 6.30% + 1.80% = <strong>8.10%</strong>.
          </div>
        </details>

        <details><summary><strong>5) DDM sanity check</strong> ‚Ä¢ Dividend next year = 1.20; Ke 9%; g 2.5%</summary>
          <div class="solve">P‚ÇÄ = 1.20/(0.09‚àí0.025) = <strong>$18.46</strong>. If your DCF equity per share is wildly different, revisit WACC, g, or cash flows.</div>
        </details>
      </div>
    </section>

    <!-- DCF SPEED CHALLENGE GAME -->
    <section id="game" class="tabcontent" role="tabpanel" aria-hidden="true">
      <div class="panel">
        <h1>üéÆ DCF Valuation Challenge</h1>
        <p class="muted">Master discounted cash flows and valuation concepts! Test your skills on WACC, terminal values, and equity bridges.</p>
        
        <div class="game-arena">
          <!-- Game Start Screen -->
          <div id="game-start" class="game-over">
            <h2>üéØ Ready to Master DCF Valuation?</h2>
            <div class="difficulty-select">
              <h3>Choose Your Level:</h3>
              <button class="diff-btn active" data-diff="easy">Analyst<br><small>16s ‚Ä¢ Core concepts</small></button>
              <button class="diff-btn" data-diff="medium">Associate<br><small>12s ‚Ä¢ Mixed calculations</small></button>
              <button class="diff-btn" data-diff="hard">VP<br><small>8s ‚Ä¢ Complex scenarios</small></button>
            </div>
            <button class="btn" onclick="startGame()">üöÄ Start Valuation</button>
            
            <!-- Leaderboard -->
            <div class="leaderboard">
              <h3>üèÜ Valuation Masters</h3>
              <div id="leaderboard-list">
                <div class="lb-entry"><span>No valuations yet!</span><span>Be the first analyst!</span></div>
              </div>
            </div>
          </div>

          <!-- Game Stats -->
          <div id="game-stats" class="game-stats" style="display:none">
            <div class="stat-card">
              <div class="stat-value" id="score">0</div>
              <div class="stat-label">Score</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="streak">0</div>
              <div class="stat-label">Streak</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="correct">0</div>
              <div class="stat-label">Correct</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="remaining">10</div>
              <div class="stat-label">Remaining</div>
            </div>
          </div>

          <!-- Question Card -->
          <div id="question-container" style="display:none">
            <div class="timer-bar">
              <div class="timer-fill" id="timer-fill"></div>
            </div>
            
            <div class="question-card" id="question-card">
              <div class="streak-indicator" id="streak-display" style="display:none">üî• <span id="streak-num">0</span></div>
              <div class="question-text" id="question-text"></div>
              <div class="answer-options" id="answer-options"></div>
            </div>
            
            <button class="btn ghost" onclick="skipQuestion()">‚è≠Ô∏è Skip</button>
          </div>

          <!-- Game Over Screen -->
          <div id="game-over" class="game-over" style="display:none">
            <h2>üìä Valuation Complete!</h2>
            <div class="final-score" id="final-score">0</div>
            <div class="performance">
              <div class="perf-item">‚úÖ <strong id="final-correct">0</strong> Correct</div>
              <div class="perf-item">‚ùå <strong id="final-wrong">0</strong> Wrong</div>
              <div class="perf-item">üî• Max Streak: <strong id="final-streak">0</strong></div>
              <div class="perf-item">‚ö° Avg: <strong id="avg-time">0s</strong></div>
            </div>
            <div class="performance-message" id="performance-msg"></div>
            <button class="btn" onclick="resetGame()">üîÑ New Valuation</button>
            <button class="btn ghost" onclick="showLeaderboard()">üìà Leaderboard</button>
          </div>
        </div>
      </div>
    </section>
  </main>

<script>
  function toggleNav(){ document.getElementById('nav').classList.toggle('show'); }
  function showTab(id){
    document.querySelectorAll('.tabbtn').forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
    document.querySelectorAll('.tabcontent').forEach(s=>{ s.classList.remove('active'); s.setAttribute('aria-hidden','true'); });
    document.querySelector('[onclick="showTab(\''+id+'\')"]').classList.add('active');
    document.querySelector('[onclick="showTab(\''+id+'\')"]').setAttribute('aria-selected','true');
    document.getElementById(id).classList.add('active');
    document.getElementById(id).setAttribute('aria-hidden','false');
    if(innerWidth<940) document.getElementById('nav').classList.remove('show');
  }

  // MCQ interactions
  document.querySelectorAll('.mcq').forEach(block=>{
    block.querySelectorAll('.opt').forEach(opt=>{
      opt.addEventListener('click',()=>{
        block.querySelectorAll('.opt').forEach(o=>{ o.classList.remove('correct','wrong'); });
        if(opt.dataset.correct==='1'){ opt.classList.add('correct'); } else { opt.classList.add('wrong'); }
        block.querySelector('.explain').style.display='block';
      });
    });
  });

  function blockSolutions(n){
    document.getElementById('sol-'+n).style.display='block';
  }

  // Difficulty buttons
  document.querySelectorAll('.diff-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // DCF Speed Challenge Game
  let gameState = {
    score: 0,
    streak: 0,
    bestStreak: 0,
    correct: 0,
    wrong: 0,
    currentQuestion: 0,
    totalQuestions: 10,
    difficulty: 'easy',
    timer: null,
    timeLeft: 16,
    questionStartTime: 0,
    responseTimes: []
  };

  const difficulties = {
    easy: { time: 16, scoreMultiplier: 1, streakBonus: 20 },
    medium: { time: 12, scoreMultiplier: 1.6, streakBonus: 25 },
    hard: { time: 8, scoreMultiplier: 2.5, streakBonus: 35 }
  };

  // DCF Question bank - focused on valuation concepts
  const questions = [
    {
      text: "FCFF should be discounted at which rate?",
      answers: ["Cost of equity", "WACC", "Cost of debt", "Risk-free rate"],
      correct: 1,
      explanation: "FCFF represents cash flows to all capital providers ‚Üí use WACC"
    },
    {
      text: "CAPM: rf=4%, Œ≤=1.3, MRP=6%. Cost of equity = ?",
      answers: ["10%", "11.8%", "12.5%", "9.2%"],
      correct: 1,
      explanation: "Ke = rf + Œ≤(MRP) = 4% + 1.3(6%) = 11.8%"
    },
    {
      text: "Terminal Value: FCF‚ÇÅ=$50k, WACC=10%, g=3%. TV = ?",
      answers: ["$714k", "$500k", "$1,000k", "$833k"],
      correct: 0,
      explanation: "TV = FCF‚ÇÅ/(WACC-g) = $50k/(0.10-0.03) = $714k"
    },
    {
      text: "Enterprise Value = $500m, Net Debt = $100m. Equity Value = ?",
      answers: ["$600m", "$400m", "$500m", "$450m"],
      correct: 1,
      explanation: "Equity = EV - Net Debt = $500m - $100m = $400m"
    },
    {
      text: "Which increases WACC (all else equal)?",
      answers: ["Higher tax rate", "Higher market risk premium", "More debt financing", "Lower beta"],
      correct: 1,
      explanation: "Higher MRP ‚Üí Higher cost of equity ‚Üí Higher WACC"
    },
    {
      text: "Growing perpetuity requires which condition?",
      answers: ["r > g", "r = g", "g > r", "Any relationship"],
      correct: 0,
      explanation: "Growth rate must be less than discount rate or PV explodes"
    },
    {
      text: "PV of perpetuity paying $200k annually at 8% = ?",
      answers: ["$1.6m", "$2.5m", "$1.25m", "$3.2m"],
      correct: 1,
      explanation: "PV = PMT/r = $200k/0.08 = $2.5m"
    },
    {
      text: "WACC = 12%, Ke = 15%, Kd = 8%, Tax = 25%. Debt weight = ?",
      answers: ["40%", "50%", "33%", "60%"],
      correct: 1,
      explanation: "12% = (1-Wd)√ó15% + Wd√ó8%√ó0.75 ‚Üí Wd = 50%"
    },
    {
      text: "FCFF = EBIT(1-T) + D&A - Capex - ŒîNWC. What's missing for FCFE?",
      answers: ["Interest expense", "Net borrowing", "Dividends", "Taxes"],
      correct: 1,
      explanation: "FCFE adds net borrowing to account for debt financing"
    },
    {
      text: "Higher ŒîNWC in forecasts will:",
      answers: ["Increase FCFF", "Decrease FCFF", "No effect", "Depends on industry"],
      correct: 1,
      explanation: "More working capital ties up cash ‚Üí Lower free cash flow"
    }
  ];

  function startGame() {
    const selectedDiff = document.querySelector('.diff-btn.active').dataset.diff;
    gameState.difficulty = selectedDiff;
    gameState.timeLeft = difficulties[selectedDiff].time;
    
    // Reset game state
    gameState.score = 0;
    gameState.streak = 0;
    gameState.bestStreak = 0;
    gameState.correct = 0;
    gameState.wrong = 0;
    gameState.currentQuestion = 0;
    gameState.responseTimes = [];
    
    // Shuffle questions
    gameState.questions = [...questions].sort(() => Math.random() - 0.5).slice(0, gameState.totalQuestions);
    
    // Show game UI
    document.getElementById('game-start').style.display = 'none';
    document.getElementById('game-stats').style.display = 'grid';
    document.getElementById('question-container').style.display = 'block';
    
    updateStats();
    showNextQuestion();
  }

  function updateStats() {
    document.getElementById('score').textContent = gameState.score.toLocaleString();
    document.getElementById('streak').textContent = gameState.streak;
    document.getElementById('correct').textContent = gameState.correct;
    document.getElementById('remaining').textContent = gameState.totalQuestions - gameState.currentQuestion;
  }

  function showNextQuestion() {
    if (gameState.currentQuestion >= gameState.totalQuestions) {
      endGame();
      return;
    }
    
    const question = gameState.questions[gameState.currentQuestion];
    const questionCard = document.getElementById('question-card');
    
    // Reset card styling
    questionCard.className = 'question-card';
    
    // Set question text
    document.getElementById('question-text').textContent = question.text;
    
    // Create answer options
    const optionsContainer = document.getElementById('answer-options');
    optionsContainer.innerHTML = '';
    
    question.answers.forEach((answer, index) => {
      const button = document.createElement('button');
      button.className = 'answer-btn';
      button.textContent = answer;
      button.onclick = () => selectAnswer(index);
      optionsContainer.appendChild(button);
    });
    
    // Update streak display
    const streakDisplay = document.getElementById('streak-display');
    if (gameState.streak > 0) {
      streakDisplay.style.display = 'block';
      document.getElementById('streak-num').textContent = gameState.streak;
    } else {
      streakDisplay.style.display = 'none';
    }
    
    // Start timer
    startTimer();
    gameState.questionStartTime = Date.now();
  }

  function startTimer() {
    gameState.timeLeft = difficulties[gameState.difficulty].time;
    updateTimerBar();
    
    gameState.timer = setInterval(() => {
      gameState.timeLeft--;
      updateTimerBar();
      
      if (gameState.timeLeft <= 0) {
        clearInterval(gameState.timer);
        selectAnswer(-1); // Time up = wrong answer
      }
    }, 1000);
  }

  function updateTimerBar() {
    const maxTime = difficulties[gameState.difficulty].time;
    const percentage = (gameState.timeLeft / maxTime) * 100;
    document.getElementById('timer-fill').style.width = percentage + '%';
  }

  function selectAnswer(selectedIndex) {
    clearInterval(gameState.timer);
    
    const responseTime = (Date.now() - gameState.questionStartTime) / 1000;
    gameState.responseTimes.push(responseTime);
    
    const question = gameState.questions[gameState.currentQuestion];
    const isCorrect = selectedIndex === question.correct;
    const questionCard = document.getElementById('question-card');
    const answerButtons = document.querySelectorAll('.answer-btn');
    
    // Disable all buttons
    answerButtons.forEach(btn => btn.onclick = null);
    
    // Show correct answer
    answerButtons.forEach((btn, index) => {
      if (index === question.correct) {
        btn.classList.add('correct');
      } else if (index === selectedIndex && !isCorrect) {
        btn.classList.add('wrong');
      }
    });
    
    if (isCorrect) {
      gameState.correct++;
      gameState.streak++;
      gameState.bestStreak = Math.max(gameState.bestStreak, gameState.streak);
      
      // Calculate score - DCF emphasizes conceptual understanding
      const basePoints = 150;
      const timeBonus = Math.floor(gameState.timeLeft * 10);
      const streakBonus = gameState.streak * difficulties[gameState.difficulty].streakBonus;
      const difficultyMultiplier = difficulties[gameState.difficulty].scoreMultiplier;
      
      const points = Math.floor((basePoints + timeBonus + streakBonus) * difficultyMultiplier);
      gameState.score += points;
      
      questionCard.classList.add('correct');
      questionCard.classList.add('bounce');
      
    } else {
      gameState.wrong++;
      gameState.streak = 0;
      questionCard.classList.add('wrong');
      questionCard.classList.add('shake');
    }
    
    gameState.currentQuestion++;
    updateStats();
    
    // Show next question after delay
    setTimeout(() => {
      questionCard.classList.remove('bounce', 'shake');
      showNextQuestion();
    }, 2500);
  }

  function skipQuestion() {
    selectAnswer(-1); // Treat skip as wrong answer
  }

  function endGame() {
    // Hide game UI
    document.getElementById('game-stats').style.display = 'none';
    document.getElementById('question-container').style.display = 'none';
    
    // Show results
    const gameOver = document.getElementById('game-over');
    gameOver.style.display = 'block';
    
    document.getElementById('final-score').textContent = gameState.score.toLocaleString();
    document.getElementById('final-correct').textContent = gameState.correct;
    document.getElementById('final-wrong').textContent = gameState.wrong;
    document.getElementById('final-streak').textContent = gameState.bestStreak;
    
    const avgTime = gameState.responseTimes.length > 0 
      ? (gameState.responseTimes.reduce((a, b) => a + b, 0) / gameState.responseTimes.length).toFixed(1)
      : '0';
    document.getElementById('avg-time').textContent = avgTime + 's';
    
    // Performance message - DCF themed
    const accuracy = (gameState.correct / gameState.totalQuestions) * 100;
    let message = '';
    if (accuracy >= 90) message = 'üéØ Valuation Master! You\'re ready for Wall Street!';
    else if (accuracy >= 80) message = 'üìä Excellent analyst! You understand DCF fundamentals.';
    else if (accuracy >= 70) message = 'üìà Good work! Review WACC and terminal value concepts.';
    else if (accuracy >= 60) message = 'üíº Keep practicing! Focus on cash flow vs accounting income.';
    else message = 'üìö Study tip: Master the DCF building blocks first!';
    
    document.getElementById('performance-msg').innerHTML = message;
    
    // Save to leaderboard
    saveScore();
  }

  function resetGame() {
    document.getElementById('game-over').style.display = 'none';
    document.getElementById('game-start').style.display = 'block';
    loadLeaderboard();
  }

  function saveScore() {
    const scores = JSON.parse(localStorage.getItem('ch12_scores') || '[]');
    const newScore = {
      score: gameState.score,
      difficulty: gameState.difficulty,
      accuracy: Math.round((gameState.correct / gameState.totalQuestions) * 100),
      avgTime: gameState.responseTimes.length > 0 ? 
        (gameState.responseTimes.reduce((a, b) => a + b, 0) / gameState.responseTimes.length).toFixed(1) : '0',
      date: new Date().toLocaleDateString()
    };
    
    scores.push(newScore);
    scores.sort((a, b) => b.score - a.score);
    scores.splice(5); // Keep top 5
    
    localStorage.setItem('ch12_scores', JSON.stringify(scores));
    loadLeaderboard();
  }

  function loadLeaderboard() {
    const scores = JSON.parse(localStorage.getItem('ch12_scores') || '[]');
    const leaderboard = document.getElementById('leaderboard-list');
    
    if (scores.length === 0) {
      leaderboard.innerHTML = '<div class="lb-entry"><span>No valuations yet!</span><span>Be the first analyst!</span></div>';
      return;
    }
    
    leaderboard.innerHTML = scores.map((score, index) => `
      <div class="lb-entry">
        <span>#${index + 1} ‚Ä¢ ${score.score.toLocaleString()} pts (${score.accuracy}% in ${score.avgTime}s)</span>
        <span>${score.difficulty.toUpperCase()} ‚Ä¢ ${score.date}</span>
      </div>
    `).join('');
  }

  function showLeaderboard() {
    resetGame();
  }

  // Initialize leaderboard on page load
  loadLeaderboard();

  // Additional MCQ interactions for existing MCQs
  document.addEventListener('DOMContentLoaded', function() {
    // Ensure all game functions are loaded
    console.log('Chapter 12 DCF Challenge loaded successfully');
  });
</script>
</body>
</html>